FROM oven/bun:1.2.21

ARG NEXT_PUBLIC_APP_API_URL
ARG NEXT_PUBLIC_WEB3AUTH_CLIENT_ID
ARG NEXT_PUBLIC_PINATA_GATEWAY
ARG NEXT_PUBLIC_DISPERSE_ADDRESS
ARG NEXT_PUBLIC_SEPOLIA_RPC_URL


ENV NEXT_PUBLIC_APP_API_URL=$NEXT_PUBLIC_APP_API_URL
ENV NEXT_PUBLIC_WEB3AUTH_CLIENT_ID=$NEXT_PUBLIC_WEB3AUTH_CLIENT_ID
ENV NEXT_PUBLIC_PINATA_GATEWAY=$NEXT_PUBLIC_PINATA_GATEWAY
ENV NEXT_PUBLIC_DISPERSE_ADDRESS=$NEXT_PUBLIC_DISPERSE_ADDRESS
ENV NEXT_PUBLIC_SEPOLIA_RPC_URL=$NEXT_PUBLIC_SEPOLIA_RPC_URL

WORKDIR /workspace

COPY ./package.json ./bun.lock ./

COPY ./packages/shared ./packages/shared
COPY ./packages/smart-contracts ./packages/smart-contracts
COPY ./apps/web/package.json ./apps/web/package.json
COPY ./apps/api/package.json ./apps/api/package.json

WORKDIR /workspace
RUN bun install

WORKDIR /workspace/apps/web
COPY ./apps/web/ ./

RUN bun run build

EXPOSE 3000

CMD ["bun", "run", "start"]